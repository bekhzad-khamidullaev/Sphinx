{% load i18n %}
{% with total_tasks=tasks_queryset.count %}
<div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 text-sm">
    <div class="p-3 bg-gray-50 dark:bg-dark-700 rounded-lg border dark:border-dark-600">
        <div class="text-xs text-gray-500 dark:text-gray-400 uppercase font-semibold mb-1">{% trans "Всего задач" %}</div>
        <div class="text-xl font-bold text-gray-800 dark:text-gray-100">{{ total_tasks }}</div>
    </div>
    {% for code, name in status_choices %}
         {% with count=tasks_queryset.filter(status=code).count %}
             {% if count > 0 %}
                <div class="p-3 bg-gray-50 dark:bg-dark-700 rounded-lg border dark:border-dark-600">
                    <div class="text-xs text-gray-500 dark:text-gray-400 uppercase font-semibold mb-1">{{ name }}</div>
                    <div class="text-xl font-bold text-gray-800 dark:text-gray-100">{{ count }}</div>
                     {% if total_tasks > 0 %}
                     {% with percentage=count|multiply:100|floatformat:0|division:total_tasks|floatformat:0 %}
                         <div class="w-full bg-gray-200 rounded-full h-1.5 dark:bg-dark-600 mt-1">
                            <div class="h-1.5 rounded-full
                                {% if code == 'completed' %}bg-green-500{% elif code == 'overdue' %}bg-red-500{% elif code == 'in_progress' %}bg-yellow-500{% elif code == 'on_hold' %}bg-blue-500{% else %}bg-gray-400{% endif %}"
                                style="width: {{ percentage }}%"></div>
                         </div>
                     {% endwith %}
                     {% endif %}
                </div>
             {% endif %}
         {% endwith %}
    {% endfor %}
</div>
{% endwith %}