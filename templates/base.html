{% load static %}
{% load i18n %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="shortcut icon" href="{% static 'img/fav.png' %}" type="image/x-icon">
    <link rel="stylesheet" href="https://kit-pro.fontawesome.com/releases/v5.12.1/css/pro.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@400;500;700&display=swap" rel="stylesheet">
    <title>{% block title %}{% endblock %}</title>
</head>
<body class="bg-gray-100 font-sans" style="font-family: 'SF Pro Display', sans-serif;">

{% if user.is_authenticated %}
<!-- start navbar -->
<div class="md:fixed md:w-full md:top-0 md:z-20 flex flex-row items-center bg-white/80 backdrop-blur-lg p-4 border-b border-gray-300 shadow-md transition-all duration-300">
    <!-- logo -->
    <div class="flex-none w-56 flex flex-row items-center">
        <a href="/" class="flex-none flex flex-row items-center">
            <img src="{% static 'img/logo.png' %}" class="w-10">
            <strong class="capitalize ml-1 flex-1 text-teal-600">Sphinx</strong>
        </a>
    </div>
    <!-- Burger menu button (всегда видимый) -->
    <button id="sideBarOpenBtn" class="flex-none text-right text-gray-900 hidden md:block">
      <i class="fad fa-bars text-2xl text-gray-700"></i>
    </button>

    <!-- right -->
    <div class="flex flex-row-reverse hidden md:block md:fixed right-0 mr-4">
        <!-- user -->
        <div class="relative">
            <button id="userMenuBtn" class="flex items-center rounded-full px-4 py-2 bg-gray-200 hover:bg-gray-300 transition-all">
                <img class="w-8 h-8 rounded-full object-cover" src="{% if user.image %}{{ user.image.url }}{% else %}{% static 'img/user.svg' %}{% endif %}">
                <span class="ml-2 text-gray-800 font-medium">{{ user.get_full_name }}</span>
            </button>
            <div id="userMenu" class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg hidden transition-all duration-300 opacity-0">
                <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-gray-100 rounded-t-lg">{% trans 'Мой профиль' %}</a>
                <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-gray-100">{% trans 'Входящие' %}</a>
                {% if user.is_superuser %}
                <a href="/admin/" class="block px-4 py-2 text-gray-800 hover:bg-gray-100">{% trans 'Админка' %}</a>
                {% endif %}
                <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-gray-100">{% trans 'Чаты' %}</a>
                <hr class="my-1">
                <!-- Language switch -->
                <form method="post" action="{% url 'set_language' %}" class="px-4 py-2">
                    {% csrf_token %}
                    <select name="language" onchange="this.form.submit()" class="w-full text-gray-800 bg-gray-100 rounded-lg p-2 border">
                        <option value="ru" {% if LANGUAGE_CODE == "ru" %}selected{% endif %}>Русский</option>
                        <option value="en" {% if LANGUAGE_CODE == "en" %}selected{% endif %}>English</option>
                    </select>
                </form>
                <hr class="my-1">
                <a href="{% url 'user_profiles:logout' %}" class="block px-4 py-2 text-gray-800 hover:bg-gray-100 rounded-b-lg">{% trans 'Выход' %}</a>
            </div>
        </div>
        <!-- end user -->
    </div>
    <!-- end right -->
</div>
<!-- end navbar -->

<!-- Backdrop -->
<div id="sidebarBackdrop" class="fixed inset-0 bg-black bg-opacity-50 hidden"></div>

<!-- Sidebar (Cupertino UI style) -->
<div id="sideBar" class="fixed top-0 left-0 z-40 w-64 h-screen bg-white/80 backdrop-blur-lg border-r border-gray-200 shadow-2xl rounded-r-3xl transform -translate-x-full transition-transform duration-300">
  <div class="flex justify-between items-center p-4">
      <p class="uppercase text-xs text-gray-500 tracking-wider font-medium">Menu</p>
      <button id="sideBarCloseBtn" class="text-gray-600 hover:text-red-500 transition-all">
          <i class="fad fa-times-circle text-xl"></i>
      </button>
  </div>

  <div class="px-4">
      <button id="dropdownDefaultButton" class="w-full flex items-center justify-between px-4 py-3 rounded-xl shadow-sm bg-white text-gray-800 font-medium hover:bg-gray-100 transition-all duration-300">
          {% trans 'Задачи' %}
          <i class="fad fa-chevron-down text-gray-500"></i>
      </button>

      <div id="dropdown-1" class="hidden bg-white/80 backdrop-blur-md shadow-lg rounded-xl w-full mt-2 overflow-hidden">
          <ul class="px-4 py-2 font-medium text-sm tracking-wide">
              <li>
                  <a href="{% url 'crm_core:category_list' %}" class="block px-4 py-3 text-gray-800 hover:bg-gray-100 transition-all rounded-xl">
                      {% trans 'Категории задач' %}
                  </a>
              </li>
              <li>
                  <a href="{% url 'crm_core:task_list' %}" class="block px-4 py-3 text-gray-800 hover:bg-gray-100 transition-all rounded-xl">
                      {% trans 'Список задач' %}
                  </a>
              </li>
              <li>
                  <a href="{% url 'crm_core:campaign_list' %}" class="block px-4 py-3 text-gray-800 hover:bg-gray-100 transition-all rounded-xl">
                      {% trans 'Кампании' %}
                  </a>
              </li>
          </ul>
      </div>
  </div>
</div>
<!-- End Sidebar -->


<!-- start content -->
<div class="mt-16 p-6">
    {% block content %}{% endblock %}
</div>
<!-- end content -->

<!-- script -->
<script>
    // User menu toggle
    document.getElementById('userMenuBtn').addEventListener('click', function() {
        let menu = document.getElementById('userMenu');
        menu.classList.toggle('hidden');
        setTimeout(() => menu.classList.toggle('opacity-0'), 10);
    });

    // Sidebar toggle logic
    const sideBar = document.getElementById('sideBar');
    const sideBarOpenBtn = document.getElementById('sideBarOpenBtn');
    const sideBarCloseBtn = document.getElementById('sideBarCloseBtn');
    const sidebarBackdrop = document.getElementById('sidebarBackdrop');

    function openSidebar() {
        sideBar.classList.remove('-translate-x-full');
        sidebarBackdrop.classList.remove('hidden');
    }

    function closeSidebar() {
        sideBar.classList.add('-translate-x-full');
        sidebarBackdrop.classList.add('hidden');
    }

    sideBarOpenBtn.addEventListener('click', openSidebar);
    sideBarCloseBtn.addEventListener('click', closeSidebar);
    sidebarBackdrop.addEventListener('click', closeSidebar);

    // Dropdown toggle
    document.getElementById('dropdownDefaultButton').addEventListener('click', function() {
        document.getElementById('dropdown-1').classList.toggle('hidden');
    });
</script>
<script src="{% static 'js/scripts.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/flowbite@2.5.1/dist/flowbite.min.js"></script>
<!-- end script -->
</body>
{% else %}
{% include 'login.html' %}
{% endif %}
</html>
