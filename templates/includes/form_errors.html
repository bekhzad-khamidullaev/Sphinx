{% load i18n %}
{# Отображение ошибок для form и опционально для formset #}
{% if form.errors or formset.errors %}
    <div role="alert" class="mb-6 p-4 border border-red-400 bg-red-50 dark:bg-red-900/30 text-red-700 dark:text-red-300 rounded-lg shadow-md">
        <div class="flex items-center mb-1">
             <i class="fas fa-exclamation-triangle text-red-600 mr-2"></i>
             <h4 class="font-semibold text-base">{% trans "Пожалуйста, исправьте ошибки:" %}</h4>
        </div>
        {# Ошибки, не связанные с полями основной формы #}
        {% if form.non_field_errors %}
            <ul class="list-disc list-inside text-sm mb-2 pl-5">
                {% for error in form.non_field_errors %}<li>{{ error }}</li>{% endfor %}
            </ul>
        {% endif %}
         {# Ошибки, не связанные с формами в наборе форм #}
         {% if formset and formset.non_form_errors %}
             <p class="font-semibold text-sm mt-2 pl-5">{% trans "Общие ошибки набора форм:" %}</p>
             <ul class="list-disc list-inside text-sm mb-2 pl-5">
                 {% for error in formset.non_form_errors %}<li>{{ error }}</li>{% endfor %}
             </ul>
         {% endif %}
        {# Ошибки полей основной формы #}
        {% for field in form %}
             {% if field.errors %}
                 <p class="font-semibold text-sm mt-2 pl-5">{{ field.label }}:</p>
                 <ul class="list-disc list-inside text-sm mb-2 pl-5">
                     {% for error in field.errors %}<li>{{ error }}</li>{% endfor %}
                 </ul>
             {% endif %}
        {% endfor %}
         {# Ошибки полей и форм в наборе форм #}
         {% if formset %}
             {% for f_form in formset %}
                   {# Общие ошибки для конкретной формы в наборе #}
                   {% if f_form.non_field_errors %}
                        <p class="font-semibold text-sm mt-2 pl-5">{% blocktrans with count=forloop.counter %}Общая ошибка в строке #{{ count }}:{% endblocktrans %}</p>
                        <ul class="list-disc list-inside text-sm mb-2 pl-5">
                            {% for error in f_form.non_field_errors %}<li>{{ error }}</li>{% endfor %}
                        </ul>
                   {% endif %}
                   {# Ошибки полей для конкретной формы в наборе #}
                   {% for field in f_form %}
                        {% if field.errors %}
                             <p class="font-semibold text-sm mt-2 pl-5">{% blocktrans with count=forloop.parentloop.counter label=field.label %}Строка #{{ count }} - {{ label }}:{% endblocktrans %}</p>
                             <ul class="list-disc list-inside text-sm mb-2 pl-5">
                                 {% for error in field.errors %}<li>{{ error }}</li>{% endfor %}
                             </ul>
                        {% endif %}
                   {% endfor %}
             {% endfor %}
         {% endif %}
    </div>
{% endif %}