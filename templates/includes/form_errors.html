{% load i18n %}

{% if form.errors or formset.errors %}
    <div role="alert" class="mb-6 p-4 border border-red-400 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 rounded-lg">
        <h4 class="font-bold text-lg mb-2">{% trans "Пожалуйста, исправьте ошибки:" %}</h4>

        {# General Form Errors #}
        {% if form.non_field_errors %}
            <ul class="list-disc list-inside text-sm mb-2">
                {% for error in form.non_field_errors %}<li>{{ error }}</li>{% endfor %}
            </ul>
        {% endif %}

        {# General Formset Errors #}
         {% if formset and formset.non_form_errors %}
             <p class="font-semibold text-sm mt-2">{% trans "Общие ошибки формы:" %}</p>
             <ul class="list-disc list-inside text-sm mb-2">
                 {% for error in formset.non_form_errors %}<li>{{ error }}</li>{% endfor %}
             </ul>
         {% endif %}

        {# Field-specific Form Errors #}
        {% for field in form %}
             {% if field.errors %}
                 <p class="font-semibold text-sm mt-2">{{ field.label }}:</p>
                 <ul class="list-disc list-inside text-sm mb-2">
                     {% for error in field.errors %}<li>{{ error }}</li>{% endfor %}
                 </ul>
             {% endif %}
        {% endfor %}

         {# Field-specific Formset Errors #}
         {% if formset %}
             {% for f_form in formset %}
                  {# Non-field errors for individual form in formset #}
                   {% if f_form.non_field_errors %}
                        <p class="font-semibold text-sm mt-2">{% blocktrans with count=forloop.counter %}Общая ошибка в строке #{{ count }}:{% endblocktrans %}</p>
                        <ul class="list-disc list-inside text-sm mb-2">
                            {% for error in f_form.non_field_errors %}<li>{{ error }}</li>{% endfor %}
                        </ul>
                   {% endif %}
                   {# Field errors for individual form in formset #}
                   {% for field in f_form %}
                        {% if field.errors %}
                             <p class="font-semibold text-sm mt-2">{% blocktrans with count=forloop.parentloop.counter label=field.label %}Строка #{{ count }} - {{ label }}:{% endblocktrans %}</p>
                             <ul class="list-disc list-inside text-sm mb-2">
                                 {% for error in field.errors %}<li>{{ error }}</li>{% endfor %}
                             </ul>
                        {% endif %}
                   {% endfor %}
             {% endfor %}
         {% endif %}

    </div>
{% endif %}