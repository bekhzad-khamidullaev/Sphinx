{% load i18n %}
{% if room.slug %}
    <div class="room-list-item relative group">
        <a href="{% url 'room:room' room.slug %}" class="block p-3 bg-white rounded-lg shadow hover:shadow-md transition-shadow border border-gray-200 hover:border-blue-300 {% if current_room and current_room.slug == room.slug %} bg-blue-50 border-blue-300 ring-1 ring-blue-200 {% endif %}">
            <div class="flex justify-between items-start">
                <h3 class="text-base font-semibold text-gray-800 mb-1 truncate pr-6 {% if current_room and current_room.slug == room.slug %}text-blue-800{% endif %}"># {{ room.name }}</h3>
                {% if room.has_unread and not current_room or room.has_unread and current_room.slug != room.slug %}
                <span class="absolute top-2 right-10 flex h-2.5 w-2.5" title="{% trans 'Есть непрочитанные сообщения' %}">
                    <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
                    <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-red-500"></span>
                </span>
                {% endif %}
            </div>
            <div class="flex items-center justify-between text-xs text-gray-500 mt-1">
                <span class="inline-flex items-center" title="{% if room.private %}{% trans 'Приватная' %}{% else %}{% trans 'Публичная' %}{% endif %}">
                    {% if room.private %}<i class="fas fa-lock mr-1"></i>{% else %}<i class="fas fa-globe-americas mr-1"></i>{% endif %}
                    {% blocktrans count participant_count=room.participants.count %}{{ participant_count }} участник{% plural %}{{ participant_count }} участников{% endblocktrans %}
                </span>
                {% if room.last_message_time %}
                    <span title="{{ room.last_message_time|date:'d.m.Y H:i:s' }}" class="inline-flex items-center">
                        <i class="far fa-clock mr-1"></i> {{ room.last_message_time|timesince }}
                    </span>
                {% else %}
                    <span class="italic text-xs">{% trans "Нет сообщений" %}</span>
                {% endif %}
            </div>
        </a>
        <div class="absolute top-1 right-1" x-data="{ open: false }">
            <button @click="open = !open" class="p-1.5 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full focus:outline-none opacity-0 group-hover:opacity-100 transition-opacity" title="{% trans 'Действия' %}">
                <i class="fas fa-ellipsis-v fa-sm"></i>
            </button>
            <div x-show="open" @click.outside="open = false"
                 x-transition:enter="transition ease-out duration-100" x-transition:enter-start="opacity-0 scale-95" x-transition:enter-end="opacity-100 scale-100"
                 x-transition:leave="transition ease-in duration-75" x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-95"
                 class="absolute right-0 mt-1 w-48 bg-white shadow-lg rounded-md border border-gray-200 z-20 overflow-hidden" x-cloak>
                <ul class="py-1 text-sm text-gray-700">
                    <li>
                        <button type="button"
                                data-action="archive-room"
                                data-url="{% url 'room:archive_room' room.slug %}"
                                data-room-name="{{ room.name|escapejs }}"
                                class="w-full text-left flex items-center px-4 py-2 hover:bg-gray-100 text-red-600">
                            <i class="fas fa-archive w-4 mr-2"></i> {% trans "Архивировать" %}
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </div>
{% else %}
    <div class="block p-3 bg-gray-100 rounded-lg shadow border border-gray-300 opacity-70 cursor-not-allowed">
        <h3 class="text-base font-semibold text-gray-600 mb-1 truncate"># {{ room.name }}</h3>
        <p class="text-xs text-red-500 mt-1">{% trans "(Ошибка: Неверный URL)" %}</p>
    </div>
{% endif %}