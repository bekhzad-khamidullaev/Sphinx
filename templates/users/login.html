{% load widget_tweaks i18n static %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE|default:'ru' }}" class="h-100">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="{% translate 'Sphinx - Вход в систему' %}">
    <link rel="shortcut icon" href="{% static 'img/fav.png' %}" type="image/x-icon">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet" crossorigin="anonymous" />
    <link rel="stylesheet" href="{% static 'vendor/bootswatch/zephyr/bootstrap.min.css' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/toastify-js" defer></script>
    <script src="{% static 'js/main.js' %}" defer></script>
    <title>{% translate 'Вход' %} | Sphinx</title>
</head>
<body class="d-flex align-items-center justify-content-center bg-light py-5">

<div id="preloader" class="position-fixed top-0 start-0 w-100 h-100 bg-white d-flex align-items-center justify-content-center">
    <div class="spinner-border text-primary" role="status"></div>
</div>

<div class="card shadow-sm p-4" style="max-width: 400px; width: 100%;">
    <div class="text-center mb-4">
        <img src="{% static 'img/logo.png' %}" alt="{% translate 'Sphinx Логотип' %}" class="img-fluid" style="height: 48px;">
        <h2 class="mt-3 h4 text-dark">{% translate 'Вход в аккаунт' %}</h2>
    </div>

    {% if messages %}
        {% for message in messages %}
        <div class="alert {% if message.level == DEFAULT_MESSAGE_LEVELS.SUCCESS %}alert-success{% elif message.level == DEFAULT_MESSAGE_LEVELS.ERROR %}alert-danger{% elif message.level == DEFAULT_MESSAGE_LEVELS.WARNING %}alert-warning{% else %}alert-info{% endif %} py-2" role="alert">
            {{ message }}
        </div>
        {% endfor %}
    {% endif %}

    {% if form.non_field_errors %}
    <div class="alert alert-danger py-2">
        {% for error in form.non_field_errors %}
        <p class="mb-0">{{ error }}</p>
        {% endfor %}
    </div>
    {% endif %}

    <form method="post" action="{% url 'user_profiles:base_login' %}" id="login-form">
        {% csrf_token %}
        <input type="hidden" name="next" value="{{ next }}">
        <div class="mb-3">
            <label for="{{ form.username.id_for_label }}" class="form-label">{{ form.username.label }}</label>
            {% render_field form.username class+='form-control' autocomplete='username' %}
            {% if form.username.errors %}<div class="text-danger small">{{ form.username.errors.0 }}</div>{% endif %}
        </div>
        <div class="mb-3">
            <label for="{{ form.password.id_for_label }}" class="form-label">{{ form.password.label }}</label>
            {% render_field form.password class+='form-control' autocomplete='current-password' %}
            {% if form.password.errors %}<div class="text-danger small">{{ form.password.errors.0 }}</div>{% endif %}
        </div>
        <div class="d-grid">
            <button type="submit" id="submit-btn" class="btn btn-primary">
                <span id="submit-text">{% translate 'Войти' %}</span>
                <span id="spinner" class="spinner-border spinner-border-sm d-none ms-2" role="status"></span>
            </button>
        </div>
    </form>
</div>

<script>
window.addEventListener('load', () => {
    const preloader = document.getElementById('preloader');
    if (preloader) {
        preloader.style.opacity = '0';
        setTimeout(() => { preloader.style.display = 'none'; }, 300);
    }
});
const loginForm = document.getElementById('login-form');
const submitButton = document.getElementById('submit-btn');
const spinnerIcon = document.getElementById('spinner');
const submitButtonText = document.getElementById('submit-text');
if (loginForm && submitButton && spinnerIcon && submitButtonText) {
    loginForm.addEventListener('submit', () => {
        spinnerIcon.classList.remove('d-none');
        submitButtonText.textContent = `{% translate "Входим..." %}`;
        submitButton.disabled = true;
    });
}
</script>
</body>
</html>
