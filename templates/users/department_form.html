{% extends 'base.html' %}
{% load i18n static crispy_forms_tags %}

{% block title %}{{ page_title }}{% endblock %}

{% block page_title_block %}
  <h2 class="text-title-md2 font-bold text-black dark:text-white">
    {{ page_title }}
  </h2>
{% endblock %}

{% block content %}
<div class="rounded-sm border border-stroke bg-white shadow-default dark:border-strokedark dark:bg-boxdark">
    <div class="border-b border-stroke px-6.5 py-4 dark:border-strokedark">
        <h3 class="font-medium text-black dark:text-white">
            {% if object %}
                {% trans "Редактирование отдела" %}: {{ object.name }}
            {% else %}
                {% trans "Создание нового отдела" %}
            {% endif %}
        </h3>
    </div>
    <div class="p-6.5">
        <form method="post">
            {% csrf_token %}
            {% crispy form %}
            {% if form.non_field_errors %}
                <div role="alert" class="mt-4 p-4 border border-danger/50 bg-danger/10 text-danger rounded-md dark:border-danger/70 dark:bg-danger/20 dark:text-red-400">
                    <h4 class="font-bold mb-1">{% trans "Ошибка формы:" %}</h4>
                    {% for error in form.non_field_errors %}<p class="text-sm">{{ error }}</p>{% endfor %}
                </div>
            {% endif %}
            <div class="flex justify-end gap-3 mt-6 pt-6 border-t border-stroke dark:border-strokedark">
                <a href="{% url 'user_profiles:department_list' %}" class="flex justify-center rounded bg-gray-200 dark:bg-gray-700 px-6 py-2 font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600">
                    {% trans 'Отмена' %}
                </a>
                <button type="submit" class="flex justify-center rounded bg-primary px-6 py-2 font-medium text-gray hover:bg-opacity-90">
                    <i class="fas fa-save mr-2 mt-0.5"></i> {{ form_action_text|default:_("Сохранить") }}
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
    {{ block.super }}
    {{ form.media.js }} {# Для Select2 виджетов #}
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    {% get_current_language as LANGUAGE_CODE %}
    {% if LANGUAGE_CODE %}
        <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/i18n/{{ LANGUAGE_CODE|slice:':2' }}.js"></script>
    {% endif %}
    <script>
        $(document).ready(function() {
            const defaultSelect2Options = {
                theme: "default", width: '100%', allowClear: true,
                language: "{{ LANGUAGE_CODE|slice:':2'|default:'en' }}"
            };
            try {
                $('.select2-single').each(function() { // Assuming crispy forms adds this class or you add it via widget attrs
                    $(this).select2({ ...defaultSelect2Options, placeholder: $(this).data('placeholder') || '{% trans "Выберите..." %}' });
                });
            } catch (e) { console.error("Error initializing Select2 for department form:", e); }
        });
    </script>
{% endblock %}