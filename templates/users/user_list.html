{% extends 'base.html' %}
{% load i18n static %}

{% block title %}{{ page_title|default:_("Пользователи") }}{% endblock %}

{% block list_title %} {# Используем стандартный блок base.html #}
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-6">
    <h1 class="text-2xl font-semibold text-gray-900 sm:text-3xl">
      {{ page_title|default:_("Пользователи") }}
    </h1>
    <nav class="flex flex-wrap gap-2">
      {% if perms.auth.view_group %}
      <a href="{% url 'profiles:group_list' %}" class="inline-flex items-center justify-center rounded-md bg-gray-100 px-4 py-2 text-center font-medium text-gray-800 hover:bg-gray-200 lg:px-6 transition active:scale-95 shadow-sm">
        <i class="fas fa-user-shield mr-2"></i> {% trans 'Группы' %}
      </a>
      {% endif %}
      {% if perms.profiles.add_user %}
      <a href="{% url 'profiles:user_create' %}" class="inline-flex items-center justify-center rounded-md bg-blue-600 px-4 py-2 text-center font-medium text-white hover:bg-blue-700 lg:px-6 transition active:scale-95 shadow-sm">
        <i class="fas fa-user-plus mr-2"></i> {% trans 'Добавить пользователя' %}
      </a>
      {% endif %}
    </nav>
  </div>
{% endblock %}

{% block list_content %} {# Используем стандартный блок base.html #}
<div class="rounded-xl border border-gray-200 bg-white px-5 pt-6 pb-2.5 shadow-lg sm:px-7 xl:pb-1">
  <div class="max-w-full overflow-x-auto scrollbar-thin scrollbar-thumb-gray-300">
    <table class="w-full table-auto">
      <thead>
        <tr class="bg-gray-100 text-left">
          <th class="min-w-[220px] py-4 px-4 font-medium text-gray-700 xl:pl-11">{% trans 'Пользователь' %}</th>
          <th class="min-w-[150px] py-4 px-4 font-medium text-gray-700">{% trans 'Email' %}</th>
          <th class="min-w-[150px] py-4 px-4 font-medium text-gray-700">{% trans 'Должность' %}</th>
          <th class="min-w-[120px] py-4 px-4 font-medium text-gray-700">{% trans 'Отдел' %}</th>
          <th class="py-4 px-4 font-medium text-gray-700 text-center">{% trans 'Статус' %}</th>
          <th class="py-4 px-4 font-medium text-gray-700 text-center">{% trans 'Действия' %}</th>
        </tr>
      </thead>
      <tbody>
        {% for list_user in object_list %}
        <tr id="user-row-{{ list_user.pk }}" class="hover:bg-gray-50">
          <td class="border-b border-gray-200 py-5 px-4 pl-9 xl:pl-11">
            <div class="flex items-center">
                <div class="h-10 w-10 rounded-full overflow-hidden mr-3 flex-shrink-0">
                    <img class="h-full w-full object-cover" src="{% if list_user.image %}{{ list_user.image.url }}{% else %}{% static 'img/user.svg' %}{% endif %}" alt="{{ list_user.display_name }}">
                </div>
                <div>
                    <h5 class="font-medium text-gray-900">{{ list_user.display_name }}</h5>
                    <p class="text-xs text-gray-500">@{{ list_user.username }}</p>
                </div>
            </div>
          </td>
          <td class="border-b border-gray-200 py-5 px-4">
            <p class="text-gray-900">{{ list_user.email }}</p>
          </td>
          <td class="border-b border-gray-200 py-5 px-4">
            <p class="text-gray-900">{{ list_user.job_title.name|default:"-" }}</p>
          </td>
          <td class="border-b border-gray-200 py-5 px-4">
            <p class="text-gray-900">{{ list_user.department.name|default:"-" }}</p>
          </td>
          <td class="border-b border-gray-200 py-5 px-4 text-center">
            {% if list_user.is_active %}
                <span class="inline-flex rounded-full bg-green-100 bg-opacity-50 py-1 px-3 text-sm font-medium text-green-700">{% trans "Активен" %}</span>
            {% else %}
                <span class="inline-flex rounded-full bg-red-100 bg-opacity-50 py-1 px-3 text-sm font-medium text-red-700">{% trans "Неактивен" %}</span>
            {% endif %}
            {% if list_user.is_staff %}
                <span class="ml-1 inline-flex rounded-full bg-yellow-100 bg-opacity-50 py-1 px-3 text-sm font-medium text-yellow-700">{% trans "Сотрудник" %}</span>
            {% endif %}
          </td>
          <td class="border-b border-gray-200 py-5 px-4">
            <div class="flex items-center justify-center space-x-3">
              {% if perms.profiles.change_user %}
              <a href="{% url 'profiles:user_update' pk=list_user.pk %}" class="text-gray-600 hover:text-blue-600" title="{% trans 'Редактировать' %}"><i class="fas fa-edit"></i></a>
              {% endif %}
              {% if perms.profiles.delete_user and request.user != list_user %}
              <a href="{% url 'profiles:user_delete' pk=list_user.pk %}" class="text-red-500 hover:text-red-700" title="{% trans 'Удалить' %}"><i class="fas fa-trash"></i></a>
              {% elif request.user == list_user %}
              <span class="text-gray-400 cursor-not-allowed" title="{% trans 'Нельзя удалить себя' %}"><i class="fas fa-trash"></i></span>
              {% endif %}
            </div>
          </td>
        </tr>
        {% empty %}
            <tr><td colspan="6" class="py-10 px-4 text-center text-gray-500">{% trans 'Пользователи не найдены.' %}</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% if is_paginated %}
    <div class="py-4 px-4">
        {% include "includes/pagination.html" with page_obj=page_obj %}
    </div>
  {% endif %}
</div>
{% endblock %}