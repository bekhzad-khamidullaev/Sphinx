{% extends 'base.html' %}
{% load i18n static %}

{% block title %}{% trans "Пользователи" %}{% endblock %}

{% block list_title %}
<h1 class="text-3xl font-semibold text-gray-900 dark:text-gray-100 sm:text-4xl">
    {% trans 'Пользователи' %}
</h1>
{% endblock %}

{% block list_actions %}
<div class="flex space-x-3 items-center ml-4">
    <a href="{% url 'user_profiles:user_create' %}" class="flex items-center px-4 py-2 min-w-[150px] justify-center rounded-full text-sm font-medium bg-blue-500 dark:bg-ios-blue text-white hover:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-dark-800 transition-all shadow">
        <i class="fas fa-user-plus mr-2"></i> {% trans 'Добавить пользователя' %}
    </a>
</div>
{% endblock %}

{% block list_actions_mobile %}
<a href="{% url 'user_profiles:user_create' %}" class="flex-1 flex items-center justify-center px-4 py-2 rounded-full text-sm font-medium bg-blue-500 dark:bg-ios-blue text-white hover:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-dark-950 transition-all shadow">
    <i class="fas fa-user-plus mr-2"></i> {% trans 'Добавить пользователя' %}
</a>
{% endblock %}

{% block list_content %}
<div class="mt-6 overflow-x-auto bg-white dark:bg-dark-800 shadow-lg rounded-xl border border-gray-200 dark:border-dark-700">
    <table class="min-w-full divide-y divide-gray-200 dark:divide-dark-600">
        <thead class="bg-gray-50 dark:bg-dark-700">
        <tr class="text-xs text-left text-gray-500 dark:text-gray-400 uppercase tracking-wider">
            <th scope="col" class="px-4 py-3"><i class="fas fa-user-circle fa-fw mr-1"></i>{% trans 'Пользователь' %}</th>
            <th scope="col" class="px-4 py-3"><i class="fas fa-envelope fa-fw mr-1"></i>{% trans 'Email' %}</th>
            <th scope="col" class="px-4 py-3"><i class="fas fa-briefcase fa-fw mr-1"></i>{% trans 'Должность' %}</th>
            <th scope="col" class="px-4 py-3"><i class="fas fa-building fa-fw mr-1"></i>{% trans 'Отдел' %}</th>
            <th scope="col" class="px-4 py-3"><i class="fas fa-users fa-fw mr-1"></i>{% trans 'Команды' %}</th>
            <th scope="col" class="px-4 py-3"><i class="fas fa-check-circle fa-fw mr-1"></i>{% trans 'Статус' %}</th>
            <th scope="col" class="px-4 py-3 text-center"><i class="fas fa-cogs fa-fw mr-1"></i>{% trans 'Действия' %}</th>
        </tr>
        </thead>
        <tbody class="bg-white dark:bg-dark-800 divide-y divide-gray-200 dark:divide-dark-700">
            {% for list_user in object_list %}
            <tr id="user-row-{{ list_user.pk }}" class="hover:bg-gray-50 dark:hover:bg-dark-700 transition-colors duration-150 text-sm text-gray-700 dark:text-gray-300">
                <td class="px-4 py-3 whitespace-nowrap">
                    <div class="flex items-center">
                        <img class="w-8 h-8 rounded-full object-cover mr-3 flex-shrink-0" src="{% if list_user.image %}{{ list_user.image.url }}{% else %}{% static 'img/user.svg' %}{% endif %}" alt="{{ list_user.display_name }}">
                        <div>
                            <a href="{% url 'user_profiles:user_update' pk=list_user.pk %}" class="font-medium text-blue-600 dark:text-blue-400 hover:underline">{{ list_user.display_name }}</a>
                            <div class="text-xs text-gray-500 dark:text-gray-400">@{{ list_user.username }}</div>
                        </div>
                    </div>
                </td>
                <td class="px-4 py-3 whitespace-nowrap">{{ list_user.email }}</td>
                <td class="px-4 py-3 whitespace-nowrap">{{ list_user.job_title|default:"-" }}</td>
                <td class="px-4 py-3 whitespace-nowrap">{{ list_user.department.name|default:"-" }}</td>
                 <td class="px-4 py-3 whitespace-nowrap text-xs">
                    {% for team in list_user.teams.all %}
                        {{ team.name }}{% if not forloop.last %}, {% endif %}
                    {% empty %}
                        <span class="text-gray-400 italic">{% trans "Нет" %}</span>
                    {% endfor %}
                 </td>
                <td class="px-4 py-3 whitespace-nowrap">
                    {% if list_user.is_active %}
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-900/80 dark:text-green-200">{% trans "Активен" %}</span>
                    {% else %}
                         <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800 dark:bg-red-900/80 dark:text-red-200">{% trans "Неактивен" %}</span>
                    {% endif %}
                </td>
                <td class="px-4 py-3 text-center whitespace-nowrap">
                    <div class="flex items-center justify-center space-x-2">
                        <a href="{% url 'user_profiles:user_update' pk=list_user.pk %}" title="{% trans 'Редактировать' %}" class="p-1.5 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-dark-600 rounded-full transition-colors focus:outline-none"><i class="fas fa-edit fa-fw"></i></a>
                        {% if request.user != list_user %}
                            <a href="{% url 'user_profiles:user_delete' pk=list_user.pk %}" title="{% trans 'Удалить' %}" class="p-1.5 text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-dark-600 rounded-full transition-colors focus:outline-none"><i class="fas fa-trash fa-fw"></i></a>
                        {% else %}
                             <span class="p-1.5 text-gray-300 dark:text-gray-600 cursor-not-allowed" title="{% trans 'Нельзя удалить себя' %}"><i class="fas fa-trash fa-fw"></i></span>
                        {% endif %}
                    </div>
                </td>
            </tr>
            {% empty %}
                <tr><td colspan="7" class="px-4 py-8 text-center text-gray-500 dark:text-gray-400 italic"><i class="fas fa-users-slash fa-2x mb-2 text-gray-400 dark:text-gray-500"></i><br>{% trans 'Пользователи не найдены.' %}</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
