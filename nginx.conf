upstream django_server {
    # Имя сервиса и порт Gunicorn из docker-compose.yml
    server app:8000;
}

server {
    listen 80;
    # Замените your_domain.com на ваш домен или IP
    server_name your_domain.com your_server_ip localhost;
    client_max_body_size 20M; # Увеличиваем лимит для загрузки фото профиля

    # Расположение для медиа файлов
    location /media/ {
        alias /usr/share/nginx/html/media/; # Путь внутри тома Nginx
        expires 7d; # Кеширование медиа
    }

    # Расположение для статических файлов
    location /static/ {
        alias /usr/share/nginx/html/static/; # Путь внутри тома Nginx
        expires 7d; # Кеширование статики
    }

    # Проксирование всех остальных запросов к Gunicorn/Django
    location / {
        proxy_pass http://django_server;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $host;
        proxy_redirect off;
        # Добавьте эти заголовки, если используете WebSockets (не нужно для простого бота/админки)
        # proxy_http_version 1.1;
        # proxy_set_header Upgrade $http_upgrade;
        # proxy_set_header Connection "upgrade";
    }

    # Обработка ошибок (опционально)
    # error_page 500 502 503 504 /50x.html;
    # location = /50x.html {
    #     root /usr/share/nginx/html;
    # }
}

# Если настраиваете HTTPS (требует сертификатов):
# server {
#     listen 443 ssl;
#     server_name your_domain.com;
#
#     ssl_certificate /etc/nginx/certs/your_domain.com.crt;
#     ssl_certificate_key /etc/nginx/certs/your_domain.com.key;
#
#     # ... (остальные настройки SSL) ...
#
#     location /media/ { ... }
#     location /static/ { ... }
#     location / { ... (те же настройки proxy_pass) ... }
# }